<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard - Long Châu</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/employee.css">
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="material-icons">person</span>
                    Long Châu Employee
                </div>
            </div>
            <nav class="nav-menu">
                <div class="nav-group">
                    <div class="nav-group-title">Khách hàng</div>
                    <div class="nav-item" id="nav-create-customer">
                        <span class="material-icons">group_add</span>
                        Tạo mới khách hàng
                    </div>
                    <div class="nav-item active" id="nav-customer-list">
                        <span class="material-icons">group</span>
                        Danh sách khách hàng
                    </div>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Đơn hàng</div>
                    <div class="nav-item" id="nav-create-order">
                        <span class="material-icons">receipt_long</span>
                        Tạo đơn thuốc
                    </div>
                    <div class="nav-item" id="nav-order-list">
                        <span class="material-icons">list_alt</span>
                        Danh sách đơn hàng
                    </div>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Cá nhân</div>
                    <div class="nav-item" id="nav-schedule">
                        <span class="material-icons">schedule</span>
                        Lịch làm việc
                    </div>
                    <div class="nav-item" id="nav-medicine-info">
                        <span class="material-icons">medication</span>
                        Thông tin thuốc
                    </div>
                </div>
            </nav>
        </aside>

        <header class="header">
            <h1 class="header-title">Quầy bán hàng</h1>
            <div class="header-actions">
                <button class="check-in-btn">
                    <span class="material-icons">access_time</span>
                    Check-in
                </button>
                <div class="user-profile">
                    <div class="avatar">NV</div>
                    <div>
                        <div style="font-weight: 500;">Nguyễn Văn An</div>
                        <div style="font-size: 12px; color: #718096;">Nhân viên bán hàng</div>
                    </div>
                    <span class="material-icons">expand_more</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Statistics Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon orders">
                            <span class="material-icons">receipt</span>
                        </div>
                    </div>
                    <div class="stat-value">24</div>
                    <div class="stat-label">Đơn hôm nay</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon customers">
                            <span class="material-icons">people</span>
                        </div>
                    </div>
                    <div class="stat-value">18</div>
                    <div class="stat-label">Khách hàng mới</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon revenue">
                            <span class="material-icons">attach_money</span>
                        </div>
                    </div>
                    <div class="stat-value">2.4M</div>
                    <div class="stat-label">Doanh số hôm nay</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon time">
                            <span class="material-icons">schedule</span>
                        </div>
                    </div>
                    <div class="stat-value">8h</div>
                    <div class="stat-label">Giờ làm việc</div>
                </div>
            </div>

            <!-- Customer Management Section -->
            <div class="customer-container">
                <!-- Customer List -->
                <div class="customers-list">
                    <div class="customers-list-header">
                        <h3 class="form-title">
                            <span class="material-icons">group</span>
                            Danh sách khách hàng
                        </h3>
                        
                        <div class="header-actions-group">
                            <!-- Ô tìm kiếm khách hàng -->
                            <div class="customer-search">
                                <span class="material-icons search-icon">search</span>
                                <input type="text" placeholder="Tìm kiếm theo tên hoặc SĐT" id="customerSearchInput">
                            </div>
                            
                            <!-- Nút thêm mới khách hàng -->
                            <button class="add-customer-btn" onclick="openAddCustomerForm()">
                                <span class="material-icons">person_add</span>
                                Thêm mới
                            </button>
                        </div>
                    </div>
                    
                    <!-- Container có thể cuộn -->
                    <div class="customers-container" id="customersContainer">
                        <!-- Loading state -->
                        <div class="customers-loading" id="customersLoading" style="display: none;">
                            <span class="material-icons">refresh</span>
                            <div>Đang tải danh sách khách hàng...</div>
                        </div>
                        
                        <!-- Empty state -->
                        <div class="customers-empty" id="customersEmpty" style="display: none;">
                            <span class="material-icons">group_off</span>
                            <div>Không tìm thấy khách hàng nào</div>
                        </div>
                        
                        <!-- Customer items will be dynamically loaded from database -->
                        <div id="customer-list">
                            <!-- Customer items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Create Customer Form -->
                <div class="create-customer-form" id="createCustomerForm">
                    <div class="create-customer-form-content">
                        <div class="form-header">
                            <h3 class="form-title">Thêm khách hàng mới</h3>
                            <button class="close-btn" onclick="closeAddCustomerForm()">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        
                        <form id="customerForm">
                            <div class="form-group">
                                <label for="fullName">Họ và tên *</label>
                                <input type="text" id="fullName" placeholder="Nhập họ và tên..." required>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Số điện thoại *</label>
                                <input type="tel" id="phone" placeholder="Nhập số điện thoại..." required>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" placeholder="Nhập email...">
                            </div>

                            <div class="form-group">
                                <label for="gender">Giới tính</label>
                                <select id="gender">
                                    <option value="">Chọn giới tính</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                    <option value="Khác">Khác</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="dateOfBirth">Ngày sinh</label>
                                <input type="date" id="dateOfBirth">
                            </div>

                            <div class="form-group">
                                <label for="medicalHistory">Tiền sử bệnh lý</label>
                                <textarea id="medicalHistory" placeholder="Nhập tiền sử bệnh lý..." rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="allergies">Dị ứng</label>
                                <textarea id="allergies" placeholder="Các thành phần dị ứng..." rows="3"></textarea>
                            </div>

                            <div class="btn-container">
                                <button type="button" class="cancel-btn" onclick="closeAddCustomerForm()">Hủy</button>
                                <button type="submit" class="submit-btn">Thêm</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Customer Detail View -->
                <div class="customer-detail-view" id="customerDetailView">
                    <div class="customer-detail-content">
                        <div class="detail-header">
                            <h3>Chi tiết khách hàng</h3>
                            <button class="close-btn" onclick="closeCustomerDetails()">
                                <span class="material-icons">close</span>
                            </button>
                        </div>

                        <div class="detail-body">
                            <div class="detail-item">
                                <span class="detail-label">Họ và tên:</span>
                                <p id="detailFullName"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Điện thoại:</span>
                                <p id="detailPhone"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email:</span>
                                <p id="detailEmail"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Giới tính:</span>
                                <p id="detailGender"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ngày sinh:</span>
                                <p id="detailDateOfBirth"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Tiền sử bệnh lý:</span>
                                <p id="detailMedicalHistory"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Dị ứng:</span>
                                <p id="detailAllergies"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Điểm tích lũy:</span>
                                <p id="detailTotalPoints"></p>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ngày tạo:</span>
                                <p id="detailCreatedDate"></p>
                            </div>
                        </div>

                        <div class="customer-detail-actions">
                            <button class="edit-customer-info-btn" onclick="openEditCustomerInfoForm()">
                                <span class="material-icons">edit</span>
                                Chỉnh Sửa Thông Tin
                            </button>
                            <button class="history-order-btn" onclick="historyOrderByCustomer()">
                                <span class="material-icons">history</span>
                                Xem Lịch Sử Đơn Hàng
                            </button>
                            
                        </div>
                    </div>
                </div>

                <!-- Main Edit Customer Section -->
                <div class="main-edit-customer-section" id="mainEditCustomerSection">
                    <div class="main-edit-container">
                        <div class="edit-header">
                            <h2 class="edit-title">
                                <span class="material-icons">edit</span>
                                Chỉnh sửa thông tin khách hàng
                            </h2>
                            <button class="close-main-edit-btn" onclick="closeMainEditCustomer()">
                                <span class="material-icons">close</span>
                            </button>
                        </div>

                        <div class="edit-content">
                            <div class="customer-preview">
                                <div class="preview-avatar" id="previewAvatar">KH</div>
                                <div class="preview-info">
                                    <h3 id="previewName">Tên khách hàng</h3>
                                    <p id="previewPhone">Số điện thoại</p>
                                </div>
                            </div>

                            <form id="mainEditCustomerForm" class="main-edit-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="mainEditFullName">
                                            <span class="material-icons">person</span>
                                            Họ và tên *
                                        </label>
                                        <input type="text" id="mainEditFullName" name="fullName" required>
                                        <span class="error-message" id="fullNameError"></span>
                                    </div>

                                    <div class="form-group">
                                        <label for="mainEditPhone">
                                            <span class="material-icons">phone</span>
                                            Số điện thoại *
                                        </label>
                                        <input type="tel" id="mainEditPhone" name="phone" required>
                                        <span class="error-message" id="phoneError"></span>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="mainEditEmail">
                                            <span class="material-icons">email</span>
                                            Email
                                        </label>
                                        <input type="email" id="mainEditEmail" name="email">
                                        <span class="error-message" id="emailError"></span>
                                    </div>

                                    <div class="form-group">
                                        <label for="mainEditGender">
                                            <span class="material-icons">wc</span>
                                            Giới tính
                                        </label>
                                        <select id="mainEditGender" name="gender">
                                        
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="mainEditDateOfBirth">
                                            <span class="material-icons">cake</span>
                                            Ngày sinh
                                        </label>
                                        <input type="date" id="mainEditDateOfBirth" name="dateOfBirth">
                                    </div>

                                    <div class="form-group">
                                        <label for="mainEditTotalPoints">
                                            <span class="material-icons">stars</span>
                                            Điểm tích lũy
                                        </label>
                                        <input type="number" id="mainEditTotalPoints" name="totalPoints" min="0" readonly>
                                        <small style="color: #718096; font-size: 12px;">Chỉ có thể xem, không thể chỉnh sửa</small>
                                    </div>
                                </div>

                                <div class="form-group full-width">
                                    <label for="mainEditMedicalHistory">
                                        <span class="material-icons">medical_services</span>
                                        Tiền sử bệnh lý
                                    </label>
                                    <textarea id="mainEditMedicalHistory" name="medicalHistory" rows="3" placeholder="Nhập tiền sử bệnh lý..."></textarea>
                                </div>

                                <div class="form-group full-width">
                                    <label for="mainEditAllergies">
                                        <span class="material-icons">warning</span>
                                        Dị ứng
                                    </label>
                                    <textarea id="mainEditAllergies" name="allergies" rows="3" placeholder="Nhập các loại dị ứng..."></textarea>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="cancel-btn" onclick="closeMainEditCustomer()">
                                        <span class="material-icons">cancel</span>
                                        Hủy
                                    </button>
                                    <button type="submit" class="save-btn" id="saveCustomerBtn">
                                        <span class="material-icons">save</span>
                                        <span class="btn-text">Lưu thay đổi</span>
                                        <span class="loading-spinner" style="display: none;">
                                            <span class="material-icons spinning">refresh</span>
                                        </span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Edit Customer Form -->
                <div class="edit-customer-info" id="editCustomerInfo">
                    <div class="edit-customer-form">
                        <div class="form-header">
                            <h3>Chỉnh sửa thông tin khách hàng</h3>
                            <button class="close-btn" onclick="closeEditCustomerForm()">
                                <span class="material-icons">close</span>
                            </button>
                        </div>

                        <form id="editCustomerForm">
                            <div class="form-group">
                                <label for="editFullName">Họ và tên</label>
                                <input type="text" id="editFullName" placeholder="Nhập họ và tên..." required>
                            </div>

                            <div class="form-group">
                                <label for="editPhone">Số điện thoại</label>
                                <input type="tel" id="editPhone" placeholder="Nhập số điện thoại..." required>
                            </div>

                            <div class="form-group">
                                <label for="editEmail">Email</label>
                                <input type="email" id="editEmail" placeholder="Nhập email...">
                            </div>

                            <div class="form-group">
                                <label for="editGender">Giới tính</label>
                                <select id="editGender">
                                    
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="editDateOfBirth">Ngày sinh</label>
                                <input type="date" id="editDateOfBirth">
                            </div>

                            <div class="form-group">
                                <label for="editMedicalHistory">Tiền sử bệnh lý</label>
                                <textarea id="editMedicalHistory" rows="3" placeholder="Nhập tiền sử bệnh lý..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="editAllergies">Dị ứng</label>
                                <textarea id="editAllergies" rows="3" placeholder="Nhập các loại dị ứng..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="editTotalPoints">Điểm tích lũy</label>
                                <input type="number" id="editTotalPoints" min="0" readonly>
                                <small style="color: #718096; font-size: 12px;">Không thể chỉnh sửa</small>
                            </div>

                            <div class="edit-form-btn-container">
                                <button type="button" class="cancel-btn" onclick="closeEditCustomerForm()">Hủy</button>
                                <button type="submit" class="save-btn">Lưu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Create Order Form -->
            <div class="create-order-container" id="createOrderForm" style="display: none;">
                <div class="order-form-header">
                    <h3 class="form-title">
                        <span class="material-icons">receipt_long</span>
                        Tạo đơn thuốc
                    </h3>
                    <button class="close-order-btn" onclick="closeCreateOrderForm()">
                        <span class="material-icons">close</span>
                    </button>
                </div>

                <div class="order-form-content">
                    <!-- Left Side - Customer & Medicine Selection -->
                    <div class="order-left-panel">
                        <!-- Customer Selection Section -->
                        <div class="customer-selection-section">
                            <h4 class="section-title">
                                <span class="material-icons">person_search</span>
                                Chọn khách hàng
                            </h4>
                            
                            <!-- Customer Search -->
                            <div class="customer-search-container">
                                <div class="search-input-group">
                                    <span class="material-icons search-icon">search</span>
                                    <input type="text" id="orderCustomerSearch" placeholder="Tìm theo tên hoặc SĐT..." class="search-input">
                                </div>
                                <button class="add-new-customer-btn" onclick="openQuickAddCustomer()">
                                    <span class="material-icons">person_add</span>
                                    Thêm mới
                                </button>
                            </div>

                            <!-- Selected Customer Display -->
                            <div class="selected-customer" id="selectedCustomer" style="display: none;">
                                <div class="customer-avatar" id="selectedCustomerAvatar">KH</div>
                                <div class="customer-info">
                                    <h5 id="selectedCustomerName">Tên khách hàng</h5>
                                    <p id="selectedCustomerPhone">Số điện thoại</p>
                                    <span class="customer-points" id="selectedCustomerPoints">Điểm: 0</span>
                                </div>
                                <button class="remove-customer-btn" onclick="removeSelectedCustomer()">
                                    <span class="material-icons">close</span>
                                </button>
                            </div>

                            <!-- Customer Search Results -->
                            <div class="customer-search-results" id="customerSearchResults" style="display: none;">
                                <!-- Results will be populated by JavaScript -->
                            </div>

                            <!-- No Customer Option -->
                            <div class="no-customer-option">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="noCustomerCheckbox">
                                    <span class="checkmark"></span>
                                    Khách hàng không có tài khoản
                                </label>
                            </div>
                        </div>

                        <!-- Medicine Selection Section -->
                        <div class="medicine-selection-section">
                            <h4 class="section-title">
                                <span class="material-icons">medication</span>
                                Chọn thuốc
                            </h4>
                            
                            <!-- Medicine Search -->
                            <div class="medicine-search-container">
                                <div class="search-input-group">
                                    <span class="material-icons search-icon">search</span>
                                    <input type="text" id="medicineSearch" placeholder="Tìm kiếm thuốc..." class="search-input">
                                </div>
                            </div>

                            <!-- Medicine Search Results -->
                            <div class="medicine-search-results" id="medicineSearchResults">
                                <!-- Sample medicines - will be populated by JavaScript -->
                                <div class="medicine-item" data-id="1" data-name="Paracetamol 500mg" data-price="2500">
                                    <div class="medicine-info">
                                        <h6>Paracetamol 500mg</h6>
                                        <p>Giảm đau, hạ sốt</p>
                                        <span class="medicine-price">2,500 VND</span>
                                    </div>
                                    <button class="add-medicine-btn" onclick="addMedicineToOrder(1, 'Paracetamol 500mg', 2500)">
                                        <span class="material-icons">add</span>
                                    </button>
                                </div>
                                
                                <div class="medicine-item" data-id="2" data-name="Amoxicillin 250mg" data-price="3500">
                                    <div class="medicine-info">
                                        <h6>Amoxicillin 250mg</h6>
                                        <p>Kháng sinh</p>
                                        <span class="medicine-price">3,500 VND</span>
                                    </div>
                                    <button class="add-medicine-btn" onclick="addMedicineToOrder(2, 'Amoxicillin 250mg', 3500)">
                                        <span class="material-icons">add</span>
                                    </button>
                                </div>
                                
                                <div class="medicine-item" data-id="3" data-name="Vitamin C 1000mg" data-price="1500">
                                    <div class="medicine-info">
                                        <h6>Vitamin C 1000mg</h6>
                                        <p>Bổ sung vitamin</p>
                                        <span class="medicine-price">1,500 VND</span>
                                    </div>
                                    <button class="add-medicine-btn" onclick="addMedicineToOrder(3, 'Vitamin C 1000mg', 1500)">
                                        <span class="material-icons">add</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side - Order Summary -->
                    <div class="order-right-panel">
                        <div class="order-summary-section">
                            <h4 class="section-title">
                                <span class="material-icons">shopping_cart</span>
                                Đơn hàng
                            </h4>

                            <!-- Order Items List -->
                            <div class="order-items-list" id="orderItemsList">
                                <div class="empty-order">
                                    <span class="material-icons">shopping_cart_outlined</span>
                                    <p>Chưa có sản phẩm nào</p>
                                </div>
                            </div>

                            <!-- Order Total -->
                            <div class="order-total">
                                <div class="total-row">
                                    <span>Tạm tính:</span>
                                    <span id="orderSubtotal">0 VND</span>
                                </div>
                                <div class="total-row discount-row" id="discountRow" style="display: none;">
                                    <span>Giảm giá (điểm):</span>
                                    <span id="orderDiscount">0 VND</span>
                                </div>
                                <div class="total-row final-total">
                                    <span>Tổng cộng:</span>
                                    <span id="orderTotal">0 VND</span>
                                </div>
                            </div>

                            <!-- Payment Method -->
                            <div class="payment-method">
                                <h5>Phương thức thanh toán</h5>
                                <div class="payment-options">
                                    <label class="radio-container">
                                        <input type="radio" name="paymentMethod" value="cash" checked>
                                        <span class="radio-checkmark"></span>
                                        Tiền mặt
                                    </label>
                                    <label class="radio-container">
                                        <input type="radio" name="paymentMethod" value="card">
                                        <span class="radio-checkmark"></span>
                                        Thẻ
                                    </label>
                                    <label class="radio-container">
                                        <input type="radio" name="paymentMethod" value="transfer">
                                        <span class="radio-checkmark"></span>
                                        Chuyển khoản
                                    </label>
                                </div>
                            </div>

                            <!-- Order Actions -->
                            <div class="order-actions">
                                <button class="cancel-order-btn" onclick="cancelOrder()">
                                    <span class="material-icons">cancel</span>
                                    Hủy đơn
                                </button>
                                <button class="create-order-btn" onclick="createOrder()">
                                    <span class="material-icons">receipt</span>
                                    Tạo đơn hàng
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Add Customer Popup -->
            <div class="quick-add-customer-popup" id="quickAddCustomerPopup" style="display: none;">
                <div class="popup-overlay" onclick="closeQuickAddCustomer()"></div>
                <div class="popup-content">
                    <div class="popup-header">
                        <h4>Thêm khách hàng nhanh</h4>
                        <button class="close-popup-btn" onclick="closeQuickAddCustomer()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <form id="quickAddCustomerForm" class="popup-form">
                        <div class="form-group">
                            <label for="quickFullName">Họ và tên *</label>
                            <input type="text" id="quickFullName" required>
                        </div>
                        <div class="form-group">
                            <label for="quickPhone">Số điện thoại *</label>
                            <input type="tel" id="quickPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="quickEmail">Email</label>
                            <input type="email" id="quickEmail">
                        </div>
                        <div class="popup-actions">
                            <button type="button" class="cancel-btn" onclick="closeQuickAddCustomer()">Hủy</button>
                            <button type="submit" class="submit-btn">Thêm và chọn</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Schedule Container -->
            <div class="schedule-container" id="scheduleContainer" style="display: none;">
                <h3 class="form-title">
                    <span class="material-icons">today</span>
                    Lịch làm việc hôm nay
                </h3>
                <div class="schedule-today">
                    <div class="schedule-info">
                        <div class="schedule-time">8:00 - 16:00</div>
                        <div class="schedule-details">
                            <div style="font-weight: 500;">Ca sáng</div>
                            <div style="font-size: 12px; color: #718096;">Thứ 2, 12/05/2025</div>
                        </div>
                    </div>
                    <div class="status-working">Đang làm việc</div>
                </div>
            </div>
        </main>
    </div>

    <script src="assets/js/employee.js"></script>
</body>
</html>