<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manager Dashboard - Long Ch√¢u</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <link rel="stylesheet" href="../assets/css/manager/manager.css"/>
</head>
<body>
<div class="dashboard">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <span class="material-icons">store</span>
        Long Ch√¢u Manager
      </div>
    </div>
    <nav class="nav-menu">
      <div class="nav-group">
        <div class="nav-group-title">B√°o c√°o</div>
        <div class="nav-item active">
          <a href="/HealthMateLC/manager/manager.html">
            <span class="material-icons">analytics</span>
            B√°o c√°o doanh thu
          </a>
        </div>
      </div>

      <div class="nav-group">
        <div class="nav-group-title">Qu·∫£n l√Ω nh√¢n vi√™n</div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/work_schedule.html">
            <span class="material-icons">schedule</span>
            L·ªãch l√†m vi·ªác
          </a>
        </div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/edit_schedule.html">
            <span class="material-icons">edit_calendar</span>
            Ch·ªânh s·ª≠a l·ªãch
          </a>
        </div>
      </div>

      <div class="nav-group">
        <div class="nav-group-title">Qu·∫£n l√Ω h√≥a ƒë∆°n</div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/view_invoices.html">
            <span class="material-icons">receipt</span>
            Xem h√≥a ƒë∆°n
          </a>
        </div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/edit_invoice.html">
            <span class="material-icons">edit</span>
            Ch·ªânh s·ª≠a h√≥a ƒë∆°n
          </a>
        </div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/delete_invoice.html">
            <span class="material-icons">delete</span>
            X√≥a h√≥a ƒë∆°n
          </a>
        </div>
        <div class="nav-item">
          <a href="/HealthMateLC/manager/export_vat.html">
            <span class="material-icons">print</span>
            Xu·∫•t VAT
          </a>
        </div>
      </div>
    </nav>
  </aside>

  <header class="header">
    <h1 class="header-title">Chi nh√°nh Qu·∫≠n 1 - Nguy·ªÖn Hu·ªá</h1>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="handleCreateSchedule()">
        <span class="material-icons">add</span>
        T·∫°o l·ªãch l√†m vi·ªác
      </button>
      <div class="user-profile">
        <div class="avatar">QL</div>
        <div>
          <div id="userFullName" style="font-weight: 500">Nguy·ªÖn Th·ªã Lan</div>
          <div id="userPharmacyName" style="font-size: 12px; color: #718096">Qu·∫£n l√Ω chi nh√°nh</div>
        </div>
        <span class="material-icons">expand_more</span>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="stats-grid">
      <div class="stat-card" onclick="handleStatCard('revenue')">
        <div class="stat-header">
          <div class="stat-icon revenue">
            <span class="material-icons">trending_up</span>
          </div>
        </div>
        <div class="stat-value">45.2M</div>
        <div class="stat-label">Doanh thu th√°ng n√†y</div>
      </div>

      <div class="stat-card" onclick="handleStatCard('orders')">
        <div class="stat-header">
          <div class="stat-icon orders">
            <span class="material-icons">shopping_cart</span>
          </div>
        </div>
        <div class="stat-value">1,847</div>
        <div class="stat-label">ƒê∆°n h√†ng th√°ng n√†y</div>
      </div>

      <div class="stat-card" onclick="handleStatCard('customers')">
        <div class="stat-header">
          <div class="stat-icon customers">
            <span class="material-icons">group</span>
          </div>
        </div>
        <div class="stat-value">892</div>
        <div class="stat-label">Kh√°ch h√†ng m·ªõi</div>
      </div>

      <div class="stat-card" onclick="handleStatCard('rating')">
        <div class="stat-header">
          <div class="stat-icon rating">
            <span class="material-icons">star</span>
          </div>
        </div>
        <div class="stat-value">4.8</div>
        <div class="stat-label">ƒê√°nh gi√° trung b√¨nh</div>
      </div>
    </div>

    <div class="content-grid">
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Doanh thu chi nh√°nh</h3>
          <div class="chart-actions">
            <select onchange="handleChartPeriod(this.value)" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
              <option value="7">7 ng√†y qua</option>
              <option value="30">30 ng√†y qua</option>
              <option value="90">3 th√°ng qua</option>
            </select>
          </div>
        </div>
        <div class="chart-placeholder">üìà Bi·ªÉu ƒë·ªì doanh thu chi nh√°nh</div>
      </div>

      <div class="reviews-container">
        <div class="reviews-header">
          <h3 class="chart-title">ƒê√°nh gi√° m·ªõi nh·∫•t</h3>
        </div>
        <div class="review-item" onclick="handleReviewClick('review1')">
          <div class="review-avatar">NV</div>
          <div class="review-content">
            <div class="review-header">
              <span class="review-name">Nguy·ªÖn VƒÉn An</span>
              <div class="review-rating">
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
              </div>
            </div>
            <p class="review-text">
              Nh√¢n vi√™n t∆∞ v·∫•n r·∫•t nhi·ªát t√¨nh, thu·ªëc ƒë·∫ßy ƒë·ªß v√† gi√° c·∫£ h·ª£p l√Ω.
            </p>
          </div>
        </div>
        <div class="review-item" onclick="handleReviewClick('review2')">
          <div class="review-avatar">LT</div>
          <div class="review-content">
            <div class="review-header">
              <span class="review-name">L√™ Th·ªã B√¨nh</span>
              <div class="review-rating">
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÜ</span>
              </div>
            </div>
            <p class="review-text">
              C·ª≠a h√†ng s·∫°ch s·∫Ω, thu·ªëc ch·∫•t l∆∞·ª£ng t·ªët. S·∫Ω quay l·∫°i l·∫ßn sau.
            </p>
          </div>
        </div>
        <div class="review-item" onclick="handleReviewClick('review3')">
          <div class="review-avatar">TM</div>
          <div class="review-content">
            <div class="review-header">
              <span class="review-name">Tr·∫ßn Minh Ch√¢u</span>
              <div class="review-rating">
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
                <span class="star">‚òÖ</span>
              </div>
            </div>
            <p class="review-text">
              D·ªãch v·ª• tuy·ªát v·ªùi, giao h√†ng nhanh ch√≥ng.
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container" style="margin-bottom: 30px">
      <div class="schedule-header">
        <h3 class="chart-title">L·ªãch l√†m vi·ªác tu·∫ßn n√†y</h3>
        <div class="schedule-actions">
          <button class="btn" onclick="handleAddSchedule()">
            <span class="material-icons">add</span>
            Th√™m l·ªãch
          </button>
        </div>
      </div>
      <div class="schedule-grid">
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-12')">
          <div class="day-name">Th·ª© 2</div>
          <div class="day-date">12</div>
          <div class="employee-shift">An (8-16h)</div>
          <div class="employee-shift">B√¨nh (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-13')">
          <div class="day-name">Th·ª© 3</div>
          <div class="day-date">13</div>
          <div class="employee-shift">Ch√¢u (8-16h)</div>
          <div class="employee-shift">D≈©ng (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-14')">
          <div class="day-name">Th·ª© 4</div>
          <div class="day-date">14</div>
          <div class="employee-shift">Emy (8-16h)</div>
          <div class="employee-shift">An (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-15')">
          <div class="day-name">Th·ª© 5</div>
          <div class="day-date">15</div>
          <div class="employee-shift">B√¨nh (8-16h)</div>
          <div class="employee-shift">Ch√¢u (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-16')">
          <div class="day-name">Th·ª© 6</div>
          <div class="day-date">16</div>
          <div class="employee-shift">D≈©ng (8-16h)</div>
          <div class="employee-shift">Emy (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-17')">
          <div class="day-name">Th·ª© 7</div>
          <div class="day-date">17</div>
          <div class="employee-shift">An (8-16h)</div>
          <div class="employee-shift">B√¨nh (16-24h)</div>
        </div>
        <div class="schedule-day" onclick="handleScheduleDay('2025-05-18')">
          <div class="day-name">Ch·ªß nh·∫≠t</div>
          <div class="day-date">18</div>
          <div class="employee-shift">Ch√¢u (8-16h)</div>
          <div class="employee-shift">D≈©ng (16-24h)</div>
        </div>
      </div>
    </div>

    <div class="invoice-table">
      <div class="table-header">
        <h3 class="chart-title">H√≥a ƒë∆°n g·∫ßn ƒë√¢y</h3>
        <div class="table-actions">
          <input type="text" placeholder="T√¨m ki·∫øm h√≥a ƒë∆°n..." onkeyup="handleSearchInvoices(this.value)">
          <select onchange="handleFilterInvoices(this.value)">
            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="COMPLETED">Ho√†n th√†nh</option>
            <option value="PENDING">Ch·ªù thanh to√°n</option>
          </select>
        </div>
      </div>
      <table class="table">
        <thead>
        <tr>
          <th>M√£ Hƒê</th>
          <th>Kh√°ch h√†ng</th>
          <th>Ng√†y</th>
          <th>T·ªïng ti·ªÅn</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>#HD001</td>
          <td>Nguy·ªÖn VƒÉn An</td>
          <td>12/05/2025</td>
          <td>450,000ƒë</td>
          <td>
            <select onchange="handleStatusChange('HD001', this.value)">
              <option value="COMPLETED" selected>Ho√†n th√†nh</option>
              <option value="PENDING">Ch·ªù thanh to√°n</option>
              <option value="CANCELLED">ƒê√£ h·ªßy</option>
            </select>
          </td>
          <td>
            <button class="btn" onclick="handleInvoiceAction('HD001', 'view')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">visibility</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD001', 'edit')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">edit</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD001', 'delete')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">delete</span>
            </button>
          </td>
        </tr>
        <tr>
          <td>#HD002</td>
          <td>L√™ Th·ªã B√¨nh</td>
          <td>12/05/2025</td>
          <td>320,000ƒë</td>
          <td>
            <select onchange="handleStatusChange('HD002', this.value)">
              <option value="COMPLETED">Ho√†n th√†nh</option>
              <option value="PENDING" selected>Ch·ªù thanh to√°n</option>
              <option value="CANCELLED">ƒê√£ h·ªßy</option>
            </select>
          </td>
          <td>
            <button class="btn" onclick="handleInvoiceAction('HD002', 'view')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">visibility</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD002', 'edit')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">edit</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD002', 'delete')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">delete</span>
            </button>
          </td>
        </tr>
        <tr>
          <td>#HD003</td>
          <td>Tr·∫ßn Minh Ch√¢u</td>
          <td>11/05/2025</td>
          <td>180,000ƒë</td>
          <td>
            <select onchange="handleStatusChange('HD003', this.value)">
              <option value="COMPLETED" selected>Ho√†n th√†nh</option>
              <option value="PENDING">Ch·ªù thanh to√°n</option>
              <option value="CANCELLED">ƒê√£ h·ªßy</option>
            </select>
          </td>
          <td>
            <button class="btn" onclick="handleInvoiceAction('HD003', 'view')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">visibility</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD003', 'edit')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">edit</span>
            </button>
            <button class="btn" onclick="handleInvoiceAction('HD003', 'delete')" style="background: #e2e8f0; color: #4a5568; padding: 4px 8px;">
              <span class="material-icons" style="font-size: 16px">delete</span>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<script>
  // C√°c h√†m x·ª≠ l√Ω s·ª± ki·ªán
async function handleUserProfile() {
    console.log('ƒêang hi·ªÉn th·ªã th√¥ng tin user...');
    try {
        const response = await fetch('http://localhost:8080/manager/profile?detail=true', {
            method: 'GET',
            credentials: 'include', // IMPORTANT: This ensures session cookies are sent
            headers: {
                'Accept': 'application/json',
                // Remove X-Session-ID header - rely on cookies instead
            }
        });

        if (!response.ok) {
            // N·∫øu c√≥ l·ªói HTTP, n√©m l·ªói v·ªõi status
            if (response.status === 401) {
                // Unauthorized - redirect to login
                alert('Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
                window.location.href = '/login.html'; // Adjust path as needed
                return;
            }
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('D·ªØ li·ªáu user profile:', data);

        // C·∫≠p nh·∫≠t UI v·ªõi d·ªØ li·ªáu ng∆∞·ªùi d√πng nh·∫≠n ƒë∆∞·ª£c t·ª´ backend
        const userFullNameElement = document.getElementById('userFullName');
        const userPharmacyNameElement = document.getElementById('userPharmacyName');

        if (userFullNameElement && data.fullName) {
            userFullNameElement.textContent = data.fullName;
        }
        if (userPharmacyNameElement && data.pharmacyName) {
            userPharmacyNameElement.textContent = data.pharmacyName;
        } else if (userPharmacyNameElement && data.pharmacyAddress) {
            // N·∫øu kh√¥ng c√≥ pharmacyName nh∆∞ng c√≥ pharmacyAddress, hi·ªÉn th·ªã ƒë·ªãa ch·ªâ chi nh√°nh
            userPharmacyNameElement.textContent = data.pharmacyAddress;
        }

        console.log('Th√¥ng tin ng∆∞·ªùi d√πng ƒë√£ ƒë∆∞·ª£c t·∫£i v√† hi·ªÉn th·ªã.');

    } catch (error) {
        console.error('L·ªói khi l·∫•y th√¥ng tin user profile:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ng∆∞·ªùi d√πng. Vui l√≤ng th·ª≠ l·∫°i. L·ªói: ' + error.message);
    }
}

// G·ªçi h√†m handleUserProfile() khi trang t·∫£i xong
document.addEventListener('DOMContentLoaded', handleUserProfile);

function handleCreateSchedule() {
    console.log('T·∫°o l·ªãch l√†m vi·ªác');
}
  function handleCreateSchedule() {
      console.log('T·∫°o l·ªãch l√†m vi·ªác');
  }

  function handleStatCard(type) {
      console.log('Click v√†o stat card:', type);
  }

  function handleChartPeriod(value) {
      console.log('Thay ƒë·ªïi kho·∫£ng th·ªùi gian:', value);
  }

  function handleReviewClick(reviewId) {
      console.log('Click v√†o review:', reviewId);
  }

  function handleScheduleDay(date) {
      console.log('Click v√†o ng√†y:', date);
  }

  function handleAddSchedule() {
      console.log('Th√™m l·ªãch l√†m vi·ªác');
  }

  function handleInvoiceAction(invoiceId, action) {
      console.log('Action v·ªõi h√≥a ƒë∆°n:', invoiceId, action);
  }

  function handleStatusChange(invoiceId, status) {
      console.log('Thay ƒë·ªïi tr·∫°ng th√°i:', invoiceId, status);
  }

  function handleSearchInvoices(value) {
      console.log('T√¨m ki·∫øm h√≥a ƒë∆°n:', value);
  }

  function handleFilterInvoices(value) {
      console.log('L·ªçc h√≥a ƒë∆°n theo tr·∫°ng th√°i:', value);
  }
</script>
</body>
</html>