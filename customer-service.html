<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Customer Service Dashboard - Long Châu</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="assets/css/customer-service.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="img-logo">
            <img src="assets/img/logo.png" alt="logo">
          </span>
          Long Châu CSKH
        </div>
      </div>
      <nav class="nav-menu">
        <div class="nav-group">
          <div class="nav-group-title">Quản lý đánh giá</div>
          <div class="nav-item active">
            <span class="material-icons">rate_review</span>
            Xem đánh giá
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-title">Khách hàng</div>
          <div class="nav-item" id="nav-upgrade-customers">
            <span class="material-icons">trending_up</span>
            Khách hàng thăng hạng
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-title">Tin nhắn & Khảo sát</div>
          <div class="nav-item" data-action="focusMessageComposer">
            <span class="material-icons">message</span>
            Soạn tin nhắn
          </div>
          <div class="nav-item" data-action="sendSurvey">
            <span class="material-icons">poll</span>
            Gửi khảo sát
          </div>
          <div class="nav-item" data-action="showIndividualMessage">
            <span class="material-icons">person</span>
            Tin riêng tư
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-title">Thống kê</div>
          <div class="nav-item" data-action="scrollToChart">
            <span class="material-icons">analytics</span>
            Biểu đồ hài lòng
          </div>
        </div>
      </nav>
    </aside>
    <header class="header">
      <h1 class="header-title">Chăm sóc khách hàng</h1>
      <div class="header-actions">
        <div class="user-profile">
          <div class="avatar">CS</div>
          <div>
            <div style="font-weight: 500">Lê Thị Mai</div>
            <div style="font-size: 12px; color: #718096">
              Chăm sóc khách hàng
            </div>
          </div>
          <span class="material-icons">expand_more</span> <!-- User Dropdown Menu -->
          <div class="user-dropdown" id="userDropdown">
            <div class="dropdown-item" id="btnUserInfo">
              <span class="material-icons">person</span>
              <span>Thông tin cá nhân</span>
            </div>
            <div class="dropdown-item" id="btnLogout">
              <span class="material-icons">logout</span>
              <span>Đăng xuất</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon messages">
              <span class="material-icons">message</span>
            </div>
          </div>
          <div class="stat-value">247</div>
          <div class="stat-label">Tin nhắn đã gửi</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon reviews">
              <span class="material-icons">star</span>
            </div>
          </div>
          <div class="stat-value">5</div>
          <div class="stat-label">Đánh giá cần xử lý</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon customers">
              <span class="material-icons">people</span>
            </div>
          </div>
          <div class="stat-value">1,456</div>
          <div class="stat-label">Khách hàng được chăm sóc</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon satisfaction">
              <span class="material-icons">sentiment_very_satisfied</span>
            </div>
          </div>
          <div class="stat-value">94%</div>
          <div class="stat-label">Mức độ hài lòng</div>
        </div>
      </div>
      <div class="reviews-container section-container section-anchor" id="reviewsContainer">
        <div class="reviews-header">
          <h3 class="section-title">
            <span class="material-icons">rate_review</span>
            Đánh giá khách hàng
          </h3>
          <div class="reviews-controls">
            <div class="search-box">
              <span class="material-icons">search</span>
              <input type="text" id="reviewSearch" placeholder="Tìm kiếm theo tên khách hàng..." class="search-input">
            </div>
            <select class="filter-select" id="pharmacyFilter">
              <option value="all">Tất cả cửa hàng</option>
            </select>
            <select class="filter-select" id="ratingFilter">
              <option value="all">Tất cả đánh giá</option>
              <option value="1">1 sao</option>
              <option value="2">2 sao</option>
              <option value="3">3 sao</option>
              <option value="4">4 sao</option>
              <option value="5">5 sao</option>
            </select>
            <select class="filter-select" id="statusFilter" onchange="filterReviews()">
              <option value="all">Tất cả trạng thái</option>
              <option value="processed">Đã xử lý</option>
              <option value="unprocessed">Chưa xử lý</option>
            </select>
          </div>
        </div> <!-- Active Filters Display - Hidden per request -->
        <div id="activeFilters" class="active-filters" style="display: none;"></div>

        <!-- Table Layout for Reviews -->
        <div class="reviews-table-container">
          <table class="reviews-table">
            <thead>
              <tr>
                <th>Khách hàng</th>
                <th>Đánh giá</th>
                <th>Nội dung</th>
                <th>Thời gian</th>
                <th>Trạng thái</th>
                <th>Thao tác</th>
              </tr>
            </thead>
            <tbody id="reviewsTableBody">
              <!-- Reviews will be dynamically rendered here -->
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <div class="pagination-info">
            <span id="paginationInfo">Hiển thị 1-5 của 10 đánh giá</span>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" id="prevBtn">
              <span class="material-icons">chevron_left</span>
            </button>
            <div class="page-numbers" id="pageNumbers">
              <!-- Page numbers will be generated here -->
            </div>
            <button class="pagination-btn" id="nextBtn">
              <span class="material-icons">chevron_right</span>
            </button>
          </div>
        </div>
      </div>
      <div class="message-composer">
        <h3 class="chart-title" style="margin-bottom: 20px">
          Soạn tin nhắn
        </h3>
        <form>
          <div class="form-group">
            <label class="form-label">Loại tin nhắn</label>
            <select class="form-select" id="messageType" onchange="loadMessageTemplate(this.value)">
              <option value="reminder">Nhắc lịch uống thuốc</option>
              <option value="survey">Khảo sát trải nghiệm</option>
              <option value="promotion">Thông báo khuyến mãi</option>
              <option value="custom">Tin nhắn tùy chỉnh</option>
            </select>
            <small id="reminderNote" style="color:#718096;display:none;">* Tin nhắn nhắc nhở uống thuốc sẽ được gửi dựa
              trên đơn hàng gần nhất của khách hàng.</small>
          </div>
          <div class="form-group">
            <label class="form-label">Kênh gửi</label>
            <div class="checkbox-group">
              <label><input type="checkbox" name="sendChannel" value="email" checked> Email</label>
              <label><input type="checkbox" name="sendChannel" value="zalo"> Zalo (SDT)</label>

            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Đối tượng gửi</label>
            <select class="form-select" onchange="toggleCustomerInput(this)">
              <option>Tất cả khách hàng</option>
              <option>Khách hàng VIP</option>
              <option>Khách hàng mới</option>
              <option value="individual">Gửi tin riêng cho khách hàng</option>
            </select>
          </div>
          <div class="form-group" id="customerInputGroup" style="display: none;">
            <label class="form-label">Tìm kiếm khách hàng</label>
            <div style="position: relative;">
              <input type="text" class="form-input" placeholder="Nhập tên hoặc số điện thoại khách hàng"
                id="customerSearch" oninput="searchCustomers(this.value)" style="width: 100%;">
              <div id="customerSuggestions" class="customer-suggestions" style="display: none;"></div>
            </div>
            <div id="selectedCustomer" class="selected-customer" style="display: none;">
              <div class="customer-info">
                <strong id="selectedCustomerName"></strong><br>
                <small id="selectedCustomerPhone" style="color: #718096;"></small><br>
                <small id="selectedCustomerEmail" style="color: #718096;"></small>
              </div>
              <button type="button" onclick="clearSelectedCustomer()" class="btn-clear">×</button>
            </div>
            <small style="color: #718096;">Tìm kiếm khách hàng trong hệ thống để gửi tin nhắn</small>
          </div>
          <div class="form-group">
            <label class="form-label">Nội dung tin nhắn</label>
            <textarea class="form-input" rows="5" id="messageContent"
              placeholder="Xin chào! Đây là lời nhắc nhở uống thuốc từ Long Châu..."></textarea>
            <div style="margin-top: 8px;">
              <small id="templateHint" style="color: #718096;"></small>
            </div>
          </div>
          <div class="form-group">
          </div><button type="submit" class="btn btn-primary">
            <span class="material-icons">send</span>
            Gửi
          </button>
        </form>
      </div>
      <div class="chart-container" id="satisfactionChartContainer">
        <div class="reviews-header">
          <h3 class="chart-title">Biểu đồ mức độ hài lòng khách hàng</h3>
          <select class="filter-select" id="chartFilter">
            <option value="30">30 ngày qua</option>
            <option value="7">7 ngày qua</option>
            <option value="90">3 tháng qua</option>
          </select>
        </div>
        <div class="chart-content">
          <div class="chart-wrapper">
            <canvas id="satisfactionChart"></canvas>
          </div>
        </div>
      </div>
      <!-- Section: Upgraded Customers (hidden by default) -->
      <div class="upgraded-customers-container section-container section-anchor" id="upgradedCustomersContainer">
        <div class="reviews-header">
          <h3 class="section-title">
            <span class="material-icons">trending_up</span>
            Danh sách khách hàng thăng hạng
          </h3>
        </div>
        <div class="reviews-table-container">
          <table class="reviews-table">
            <thead>
              <tr>
                <th>Khách hàng</th>
                <th>Số điện thoại</th>
                <th>Hạng cũ</th>
                <th>Hạng mới</th>
                <th>Ngày thăng hạng</th>
                <th>Thao tác</th>
              </tr>
            </thead>
            <tbody id="upgradedCustomersTableBody">
              <!-- Upgraded customers will be dynamically rendered here -->
            </tbody>
          </table>
        </div>
      </div>
  </div>
  </main>
  </div>

  <!-- User Information Modal -->
  <div class="modal-overlay" id="userInfoModal">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">person</span>
          Thông tin nhân viên
        </h3>
        <button class="modal-close" onclick="closeUserInfoModal()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <div id="modalEmployeeError" style="display:none;color:#e53e3e;margin-bottom:10px"></div>
        <div class="employee-info-card">
          <div class="employee-avatar-large">
            <span class="material-icons">person</span>
          </div>

          <div class="employee-details">
            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">badge</span>
                Họ và tên
              </span>
              <span class="info-value" id="modalEmployeeName">Lê Thị Mai</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">work</span>
                Vị trí
              </span>
              <span class="info-value" id="modalEmployeeRole">Chăm sóc khách hàng</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">alternate_email</span>
                Email
              </span>
              <span class="info-value" id="modalEmployeeEmail">mai.le@longchau.vn</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">phone</span>
                Điện thoại
              </span>
              <span class="info-value" id="modalEmployeePhone">0905123456</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">account_circle</span>
                Tài khoản
              </span>
              <span class="info-value" id="modalEmployeeUsername">cskh_mai</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">schedule</span>
                Trạng thái
              </span>
              <span class="status-badge active" id="modalEmployeeStatus">
                <span class="status-dot"></span>
                Đang hoạt động
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeUserInfoModal()">Đóng</button>
      </div>
    </div>
  </div>

  <!-- Customer Information Popup -->
  <div class="modal-overlay" id="customerInfoModal">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">person</span>
          Thông tin khách hàng
        </h3>
        <button class="modal-close" onclick="closeCustomerInfoModal()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="customer-info-card">
          <div class="customer-avatar-large">
            <span class="material-icons">person</span>
          </div>

          <div class="customer-details">
            <!-- Thông tin cá nhân -->
            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">badge</span>
                Họ và tên
              </span>
              <span class="info-value" id="modalCustomerName">---</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">phone</span>
                Điện thoại
              </span>
              <span class="info-value" id="modalCustomerPhone">---</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">alternate_email</span>
                Email
              </span>
              <span class="info-value" id="modalCustomerEmail">---</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">star</span>
                Hạng thành viên
              </span>
              <span class="info-value" id="modalCustomerRank">---</span>
            </div>

            <div class="info-row">
              <span class="info-label">
                <span class="material-icons">store</span>
                Cửa hàng thường mua
              </span>
              <span class="info-value" id="modalCustomerStore">---</span>
            </div>
          </div>
        </div>

        <!-- Lịch sử giao dịch -->
        <div class="customer-history">
          <h4 class="section-subtitle">Lịch sử đánh giá</h4>
          <div class="review-history-list" id="customerReviewHistory">
            <!-- Lịch sử đánh giá sẽ được thêm động -->
            <div class="empty-state">Chưa có đánh giá nào</div>
          </div>

          <h4 class="section-subtitle mt-4">Đơn hàng gần nhất</h4>
          <div class="recent-order" id="customerRecentOrder">
            <!-- Chi tiết đơn hàng gần nhất -->
            <div class="empty-state">Không có đơn hàng gần đây</div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeCustomerInfoModal()">Đóng</button>
        <button class="btn-primary-modal" onclick="sendMessageToCustomer()">
          <span class="material-icons">message</span>
          Gửi tin nhắn
        </button>
      </div>
    </div>
  </div>
  <script src="assets/js/CustomerService/customer-service.js" type="module"></script>
  <script src="assets/js/CustomerService/cs-ui.js" type="module"></script>
</body>

</html>